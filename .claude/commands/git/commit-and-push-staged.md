ステージング済みファイルのみをコミットしてプッシュ

---

allowed-tools: ["Bash"]
description: "ステージング済みファイルのみを安全にコミット・プッシュ"

---

# commit-and-push-staged

ステージングされているファイルのみをコミットし、成功した場合はプッシュします。

## 重要な禁止事項

🚫 **絶対禁止事項**:

- `git add` や `git add -A` でファイルを追加することは**絶対に禁止**
- ~~`--no-verify` オプションの使用は**絶対に絶対に絶対に禁止**~~ → 下記の特例あり
- ~~コミット時のチェックをスキップすることは**いかなる理由でも禁止**~~ → 下記の特例あり

### --no-verify の使用に関する特例

⚠️ **極めて限定的な特例**:

`--no-verify` は以下の条件を**全て満たす場合のみ**使用可能：

1. **コミット対象に JavaScript/TypeScript ファイル（.js, .ts, .tsx, .jsx）が含まれていない**
2. **Biome の仕様により「No files found」エラーが発生している**
3. **実際のコード品質に問題がない（他のチェックは全て成功）**

この場合のみ、以下のようにコミット：

```bash
git commit -m "コミットメッセージ" --no-verify
```

🚨 **絶対禁止**：

- TypeScript 型エラーやテスト失敗を回避するための--no-verify 使用
- 手抜きやコード品質の妥協のための--no-verify 使用
- 上記条件を満たさない状況での--no-verify 使用

## Instructions

1. ステージング済みファイルに `task-X.X-*.md` が含まれるか確認し、該当タスクを完了済みに更新
   - !git diff --cached --name-only | grep 'task-[0-9]\+\.[0-9]\+-'
   - 該当ファイルがある場合は `.kiro/specs/<spec名>/tasks.md`（`task-X.X-*.md` があるディレクトリと同じ階層）を開き、対応する `X.X` のチェックボックスを `[x]` に更新し、該当する tasks.md だけ追加でステージングを完了させてから以降の手順を実行する
   - この同期を忘れると実装状況と仕様管理がズレるため、コミット作業を進める前に必ず完了を確認する

2. 現在のブランチ名を確認
   !git branch --show-current

3. ステージングされているファイルを確認（追加の add は禁止）
   !git status --porcelain | grep '^[AM]'

4. ステージングされた変更の詳細を確認
   !git diff --cached

5. 変更内容を分析して、以下の観点でコミットメッセージを「日本語」で作成：
   - 変更の種類（feat/fix/refactor/style/docs/test/chore など）
   - 変更の対象（影響を受けるファイルやモジュール）
   - 変更の目的（なぜこの変更が必要か）
   - 簡潔で明確な説明（1 行目は 50 文字以内）

6. 作成した日本語のコミットメッセージでコミットを実行

   **通常の場合**:
   !git commit -m "$(cat <<'EOF'
   [生成されたコミットメッセージ]
   EOF
   )"

   **上記特例条件を満たす場合のみ**:
   !git commit -m "[生成されたコミットメッセージ]" --no-verify

7. コミット結果を確認：
   - 全てのチェックが ✔️ で成功していることを確認
   - 🥊 マークがある場合はいずれかのチェックに引っかかっていてコミット失敗しています

   - コミット成功の場合：手順 8 へ進む
   - コミット失敗の場合：以下を実行

   **コミット失敗時の対処**：
   以下のファイルに記載されている内容を確認して実行してください：

   ```
   @.claude/commands/git/pre-commit-check.md
   ```

   このファイルには以下の処理が記載されています：
   - lefthook.yml の pre-commit チェック項目を全て実行
   - エラーが発生したら即座に最新情報を検索（Brave MCP 使用）
   - TypeScript 修正時は`any`と`as`を禁止
   - 全てのチェックが ✔️ になるまで修正

   修正完了後、手順 6 から再実行。

8. コミット成功時のみ、現在のブランチをリモートにプッシュ
   !git push origin HEAD

9. プッシュ結果を確認
   !git log -1 --oneline
   !git status

## 注意事項

- すでに必要なファイルのみがステージングされている前提で動作
- 追加のファイルを add することは禁止
- コミット時の検証をスキップすることは禁止
- エラーが発生した場合は、必ず原因を修正してから再実行
