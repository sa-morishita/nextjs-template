ステージング済みファイルのコード品質・パフォーマンスチェック

---

allowed-tools: ["Bash", "Read", "Grep", "TodoWrite", "mcp__brave-search__brave_web_search", "mcp__context7__resolve-library-id", "mcp__context7__get-library-docs"]
description: "stagedファイルのパフォーマンスとコード品質を分析し、改善提案を含むレポートを作成"

---

# code-quality-check

ステージングされているファイルのコード品質とパフォーマンスを包括的に分析し、改善提案を含むレポートを作成します。

## 概要

このコマンドは、stagedファイルを分析し、AIが自律的に以下の観点でコード品質を評価します：
- パフォーマンスの問題
- コードの可読性と保守性
- ベストプラクティスの遵守
- 最新技術動向との乖離
- リファクタリングの機会

必要に応じて最新の技術情報を調査し、現在のベストプラクティスに基づいた改善提案を行います。

## Instructions

### 1. ステージングされているファイルの確認

!git status --porcelain | grep '^[AM]' | cut -c4-

ステージングされているファイルのリストを取得します。

### 2. プロジェクトコンテキストの把握

以下の情報を収集してプロジェクトの特性を理解：
- package.jsonから使用ライブラリとバージョンを確認
- tsconfig.jsonから TypeScript の設定を確認
- プロジェクトのディレクトリ構造からアーキテクチャを推測

### 3. 最新技術情報の事前調査

チェックポイントを適切に設定するため、必要に応じて最新の技術情報を取得：

#### 調査実施の判断基準
- 新しいライブラリやフレームワークの使用
- 既存ライブラリの大幅なバージョンアップ
- パフォーマンスクリティカルなコードの変更
- アーキテクチャパターンの変更
- 前回の調査から一定期間が経過している場合

#### 調査内容

1. **使用技術の最新ベストプラクティス**：
   !date '+%Y年%m月'
   
   - フレームワークの新機能と推奨パターン
   - パフォーマンス最適化の新手法
   - 非推奨になったAPIや機能

2. **公式ドキュメントの確認**：
   - MCP Context7で関連ライブラリの最新ドキュメントを取得
   - 新しい推奨事項やアンチパターンの確認

3. **コミュニティのトレンド**：
   - 広く採用されている新しいパターン
   - パフォーマンス改善のケーススタディ
   - よくある落とし穴と解決策

### 4. チェックポイントの決定

ステージングされているファイルの内容と最新の技術情報に基づいて、以下のチェックポイントから必要なものを選択：

#### ⚡ パフォーマンスチェックポイント
- [ ] 不要な再レンダリング（React/Next.js）
- [ ] 重い計算処理の最適化機会
- [ ] バンドルサイズへの影響
- [ ] 非同期処理の効率性
- [ ] メモリリークの可能性
- [ ] データフェッチングの最適化
- [ ] 画像・アセットの最適化

#### 🏗️ アーキテクチャ・設計チェックポイント
- [ ] SOLID原則の遵守
- [ ] 適切な抽象化レベル
- [ ] 責任の分離（SoC）
- [ ] 再利用可能性
- [ ] テスタビリティ
- [ ] 結合度と凝集度
- [ ] デザインパターンの適用機会

#### 📝 コード品質チェックポイント
- [ ] 可読性（命名、構造、コメント）
- [ ] 複雑度（循環的複雑度、認知的複雑度）
- [ ] 重複コードの検出
- [ ] エラーハンドリングの適切性
- [ ] 型の活用度（TypeScript）
- [ ] 一貫性（スタイル、パターン）

#### 🔧 保守性チェックポイント
- [ ] 変更の影響範囲
- [ ] ドキュメンテーション
- [ ] テストの書きやすさ
- [ ] 設定の外部化
- [ ] ログ出力の適切性
- [ ] モニタリング考慮

#### 🚀 最新技術・ベストプラクティスチェックポイント
- [ ] 使用ライブラリの最新版との差異
- [ ] 非推奨API/機能の使用
- [ ] 新しい言語機能の活用機会
- [ ] パフォーマンス最適化の新手法
- [ ] セキュリティのベストプラクティス

### 5. 自律的なチェックの実行

選択したチェックポイントに基づいて、以下の手順で分析を実行：

1. **静的解析**：
   - ファイルの構造と内容を読み込んで分析
   - パターンマッチングで問題を検出
   - 複雑度やサイズを測定

2. **コンテキスト分析**：
   - プロジェクト全体での使用パターンを確認
   - 既存コードとの一貫性を評価
   - 依存関係の影響を分析

3. **事前調査情報の活用**：
   - 最新のベストプラクティスに照らして評価
   - 非推奨パターンの検出
   - より良い実装方法の提案

### 6. 改善提案の作成

各問題に対して以下の情報を含む改善提案を作成：

1. **問題の説明**：何が問題なのか、なぜ問題なのか
2. **影響度**：パフォーマンス、保守性、可読性への影響
3. **改善方法**：具体的なコード例を含む修正案
4. **期待される効果**：改善による具体的なメリット
5. **実装の優先度**：緊急度と重要度に基づく推奨

### 7. 最終レポートの作成

```
📊 コード品質・パフォーマンスチェックレポート
=============================================

📁 分析対象ファイル: [ファイル数]件
[ファイルリスト]

🔍 実施した分析:
[選択されたチェックポイントとその理由]

📈 品質スコア（10点満点）:
- パフォーマンス: [スコア]/10
- 可読性: [スコア]/10
- 保守性: [スコア]/10
- ベストプラクティス: [スコア]/10

🎯 改善提案サマリー:

⚡ パフォーマンス改善（[件数]件）
[具体的な改善案と期待される効果]

🏗️ アーキテクチャ改善（[件数]件）
[設計上の改善案と長期的なメリット]

📝 コード品質改善（[件数]件）
[可読性や保守性の向上案]

🚀 最新技術の活用（[件数]件）
[新しい機能やAPIの活用提案]

💡 実装優先度:

1️⃣ 高優先度（すぐに対応推奨）:
   [影響が大きく、実装が簡単な改善]

2️⃣ 中優先度（次回のリファクタリングで対応）:
   [効果はあるが、工数がかかる改善]

3️⃣ 低優先度（長期的に検討）:
   [将来的に検討すべき改善]

📚 参考情報:
[調査した最新技術情報や参考リンク]

⏱️ 推定改善時間:
- 全体: [推定時間]
- 高優先度のみ: [推定時間]

📋 次のステップ:
1. [最も重要な改善から始める]
2. [テストを書いてから改善を実施]
3. [チームでレビューして合意を得る]
```

### 8. インタラクティブな深掘り

レポート提示後、以下のオプションを提供：
- 特定の改善提案の詳細なコード例
- 別の実装方法の検討
- 最新技術情報の追加調査
- チーム向けの説明資料の作成

## 使用例

```
/git:code-quality-check
```

## 調査オプション

最新技術情報の調査を積極的に行いたい場合：
```
/git:code-quality-check --with-research
```

## 重要な原則

1. **建設的な提案**: 批判ではなく、具体的な改善案を提示
2. **実用性重視**: 理想論ではなく、現実的な改善を優先
3. **段階的改善**: 一度にすべてを変えるのではなく、段階的なアプローチ
4. **チームの文脈**: プロジェクトの慣習や制約を考慮
5. **最新技術の活用**: 新しい技術の恩恵を積極的に取り入れる

## 注意事項

- すべての提案が必須ではありません
- プロジェクトの状況に応じて取捨選択してください
- パフォーマンス測定値は推定であり、実測が必要な場合があります
- 最新技術の採用は、チームのスキルセットも考慮してください